<!doctype html>
<html lang="zh-Hant">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover">
<title>äº’å‹•å¼ç·šä¸Šå±•è¦½ï¼ˆ23 å±•å° / å¤šå¹³å°ï¼‰</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;700&display=swap" rel="stylesheet">
<style>
:root{--primary:#a8d5ba;--bg:#071428;--panel:rgba(255,255,255,0.04);--text:#e6eef8;--muted:#9fb3c8}
*{box-sizing:border-box}
html,body{height:100%;margin:0;font-family: 'Noto Sans TC', system-ui, sans-serif;background:linear-gradient(180deg,var(--bg),#00111a);color:var(--text)}
.app{display:flex;flex-direction:row;height:100vh;gap:12px;padding:12px}
.stage{flex:1;position:relative;border-radius:12px;overflow:hidden;box-shadow:0 8px 30px rgba(0,0,0,0.6)}
canvas{width:100%;height:100%;display:block;background:linear-gradient(180deg,#03121b,#00121a)}
.hud{position:absolute;left:12px;top:12px;padding:8px;border-radius:8px;background:var(--panel);font-size:14px;z-index:10}
.panel{width:340px;max-width:38%;background:rgba(255,255,255,0.03);border-radius:12px;padding:14px;overflow:auto}
h2{margin:0 0 8px 0}
.muted{color:var(--muted);font-size:13px}
.small{font-size:13px;padding:6px 10px;border-radius:8px;background:var(--panel);color:var(--text);border:none;cursor:pointer;transition:background 0.2s}
.small:hover{background:rgba(255,255,255,0.08)}
.small.btn{background:var(--primary);color:#000;font-weight:700;}
.small.btn:hover{background:#b8e5ca;}
.modal{position:fixed;inset:0;display:flex;align-items:center;justify-content:center;background:rgba(0,0,0,0.75);z-index:60;visibility:hidden;opacity:0;transition:opacity 0.3s}
.modal.open{visibility:visible;opacity:1}
.card{background:#071428;padding:16px;border-radius:12px;max-width:90%;width:94%;color:var(--text);display:flex;flex-wrap:wrap;gap:12px;position:relative}
/* åŠ å¤§å±•å°å¡ç‰‡å¯¬åº¦ */
.modal#boothModal .card{
Â  Â  width: 900px;Â 
Â  Â  max-width: 90%;Â 
}
.card img{max-width:100%;border-radius:8px;flex-shrink:0;width:300px;height:auto;cursor:grab}
.modal#boothModal .card img{
Â  Â  width: 400px;Â 
Â  Â  cursor: zoom-in;Â 
}
.card .close-btn{position:absolute;top:8px;right:8px;background:var(--primary);border:none;color:#000;font-weight:700;font-size:16px;border-radius:50%;width:32px;height:32px;cursor:pointer;line-height:32px;padding:0;text-align:center;transition:opacity 0.2s}
.card .close-btn:hover{opacity:0.8}
.joystick-wrap{position:fixed;left:12px;bottom:12px;width:140px;height:140px;border-radius:50%;display:none;z-index:50;background:rgba(0,0,0,0.2)}
.stick{position:absolute;left:50%;top:50%;transform:translate(-50%,-50%);width:70px;height:70px;border-radius:50%;background:rgba(255,255,255,0.06);display:flex;align-items:center;justify-content:center;transition:transform 0.1s}
.interact-btn{position:fixed;right:12px;bottom:24px;padding:12px 16px;border-radius:10px;background:var(--primary);color:#000;z-index:50;display:none;border:none;font-weight:700;cursor:pointer}
.char-grid{display:flex;gap:8px;flex-wrap:wrap;margin-top:8px}
.char-item{width:72px;height:72px;border-radius:8px;overflow:hidden;border:2px solid transparent;cursor:pointer;position:relative;display:flex;align-items:center;justify-content:center;font-size:36px} /* èª¿æ•´ç‚º Emoji é¡¯ç¤º */
.char-item img{width:100%;height:100%;object-fit:cover;display:block}
.char-item.selected{border-color:var(--primary)}
.char-item::after{content:attr(data-name);position:absolute;bottom:0;left:0;right:0;background:rgba(0,0,0,0.6);color:#fff;font-size:10px;text-align:center;padding:1px 0}
@media (max-width:900px){
Â  Â  .app{padding:8px}
Â  Â  .panel{display:none}
Â  Â  .joystick-wrap{display:block}
Â  Â  .interact-btn{display:block}
Â  Â  .hud{left:8px;top:8px}
Â  Â  /* æ‰‹æ©Ÿä¸Šå±•å°å¡ç‰‡åœ–ç‰‡ä½”æ»¿å¯¬åº¦ */
Â  Â  .modal#boothModal .card img {
Â  Â  Â  Â  width: 100%;Â 
Â  Â  Â  Â  cursor: zoom-in;
Â  Â  }
}
</style>
</head>
<body>
<div class="app">
Â  <div class="stage" id="stage">
Â  Â  <div class="hud" id="hud">è¼‰å…¥ä¸­â€¦ è«‹ç­‰å¾…åœ–ç‰‡è¼‰å…¥</div>
Â  Â  <canvas id="game"></canvas>
Â  </div>
Â  <div class="panel" id="panel">
Â  Â  <h2>å±•å ´è¨­å®šï¼ˆåƒ…å¾Œå°ï¼‰</h2>
Â  Â  <div class="muted">æœ¬ç¯„ä¾‹ç‚ºé è¨­ 23 å€‹å±•å°ï¼Œå¾Œå°å¯èª¿æ•´åº§æ¨™ã€æ¨™é¡Œèˆ‡åœ–ç‰‡ã€‚ä½¿ç”¨è€…ä»‹é¢ä¸æä¾›æ–°å¢å±•å°åŠŸèƒ½ã€‚</div>
Â  Â  <hr style="margin:12px 0">
Â  Â  <div><strong>ç›®å‰å±•å°æ•¸ï¼š</strong><span id="boothCount">23</span></div>
Â  Â  <div style="margin-top:8px" class="muted">é è¨­å±•å°åº§æ¨™å·²å›ºå®šæ–¼åœ°åœ–ä¸Šã€‚å¯åœ¨å¾Œå° JSON ä¿®æ”¹ `booths` é™£åˆ—ä»¥èª¿æ•´ã€‚</div>
Â  Â  <hr style="margin:12px 0">
Â  Â  <h3>è§’è‰²é¸æ“‡ï¼ˆç©å®¶ï¼‰</h3>
Â  Â  <div class="muted">ç©å®¶å¯åœ¨é€²å…¥å‰å¾é è¨­è§’è‰²ä¸­é¸ä¸€ä½ã€‚</div>
Â  Â  <div style="margin-top:8px;text-align:center" id="panelCharPreview"></div>
Â  Â  <div style="margin-top:12px;text-align:center">
Â  Â  Â  <button id="openCharBtn" class="small">é¸æ“‡/æ›´æ›è§’è‰²</button>
Â  Â  </div>
Â  Â  <hr style="margin:12px 0">
Â  Â  <h3>æ“ä½œèªªæ˜</h3>
Â  Â  <ul class="muted">
Â  Â  Â  <li>é›»è…¦ï¼šæ–¹å‘éµ / WASD ç§»å‹•ï¼Œé è¿‘å±•å°æŒ‰ **E** äº’å‹•ï¼Œæ»‘é¼ å¯æ‹–æ›³è¦–è§’ï¼Œæ»¾è¼ªç¸®æ”¾ã€‚</li>
Â  Â  Â  <li>æ‰‹æ©Ÿï¼šå·¦ä¸‹è™›æ“¬æ–æ¡¿ç§»å‹•ï¼Œå³ä¸‹äº’å‹•æŒ‰éˆ•é–‹å•Ÿå±•å°ï¼ˆæˆ–é»æ“Šå±•å°ï¼‰ã€‚</li>
Â  Â  </ul>
Â  </div>
</div>

<div class="joystick-wrap" id="joyWrap"><div class="stick" id="stick"></div></div>
<button class="interact-btn" id="touchInteract">äº’å‹•</button>

<div class="modal" id="charModal">
Â  <div class="card">
Â  Â  <h3 style="width:100%;margin-top:0">é¸æ“‡è§’è‰²</h3>
Â  Â  <div class="muted" style="width:100%">å¾é è¨­è§’è‰²ä¸­é¸æ“‡ä¸€å€‹å¤–è§€ï¼Œé¸æ“‡å¾Œé–‹å§‹éŠæˆ²ã€‚</div>
Â  Â  <div class="char-grid" id="charGrid"></div>
Â  Â  <div style="margin-top:12px;text-align:right;width:100%"><button id="charConfirm" class="small btn" disabled>ç¢ºèªä¸¦é–‹å§‹</button></div>
Â  Â  <button class="close-btn" onclick="closeModal(charModal)">&times;</button>Â  Â </div>
</div>

<div class="modal" id="boothModal">
Â  <div class="card" id="boothCard" style="position:relative">
Â  Â  <button class="close-btn" id="boothClose">&times;</button>
Â  Â  Â  Â  <img id="boothImg" src="" alt="" data-original-src="">Â 
Â  Â  <div class="desc">
Â  Â  Â  <h3 id="boothTitle"></h3>
Â  Â  Â  <p id="boothDesc" class="muted"></p>
Â  Â  </div>
Â  </div>
</div>

<script>
const IMAGE_FORMAT = '.jpg';Â 

const NUM_BOOTHS=23;

// ã€ä¿®æ­£é» 2ã€‘ï¼šè§’è‰²æ”¹ç‚ºæ›´å¯æ„›çš„ Emoji
const CHAR_PRESETS=[
Â  Â  {id:'char1',name:'å·¥ç¨‹å¸«',emoji:'ğŸ¤–',w:36,h:40},
Â  Â  {id:'char2',name:'å°ä¸‘',emoji:'ğŸ¤¡',w:36,h:40},
Â  Â  {id:'char3',name:'å¤–æ˜Ÿäºº',emoji:'ğŸ‘½',w:36,h:40},
Â  Â  {id:'char4',name:'å¹½éˆ',emoji:'ğŸ‘»',w:36,h:40}
];

// å±•å° Y è»¸èª¿æ•´é‡ã€‚ä¸Šæ¬¡æ˜¯ 80ï¼Œé€™æ¬¡æˆ‘å°‡å…¶å¢åŠ åˆ° 120ï¼Œç¢ºä¿æ¨™é¡Œæœ‰æ›´å¤šç©ºé–“åœ¨ä¸Šæ–¹ã€‚
const Y_OFFSET = 120; 

// [ä¿®æ”¹é–‹å§‹] 23 å€‹å±•å°è³‡æ–™ (Y åº§æ¨™å·²å‘ä¸‹èª¿æ•´ Y_OFFSET)
const booths = [
Â  Â  // --- ç¬¬ä¸€æ’ (åŸ Y=100 -> ç¾ Y=220) ---
Â  Â  {
Â  Â  Â  Â  id: 1, x: 100, y: 100 + Y_OFFSET, w: 200, h: 120,
Â  Â  Â  Â  title: "å±•å° 01ï¼šæ™ºæ…§åŸå¸‚æ‡‰ç”¨èˆ‡æœªä¾†è¶¨å‹¢åˆ†æ", // é€™æ˜¯å€‹å¾ˆé•·çš„åå­—
Â  Â  Â  Â  desc: "æœ¬å±•å€ä»‹ç´¹äº†æœ€æ–°çš„äº¤é€šç›£æ§ç³»çµ±èˆ‡AIé©…å‹•çš„å…¬å…±å®‰å…¨è§£æ±ºæ–¹æ¡ˆã€‚é»æ“Šåœ–ç‰‡å¯æ”¾å¤§è§€çœ‹è©³ç´°è¨­è¨ˆåœ–ã€‚",
Â  Â  Â  Â  img: `images/1${IMAGE_FORMAT}`
Â  Â  },
Â  Â  {
Â  Â  Â  Â  id: 2, x: 360, y: 100 + Y_OFFSET, w: 200, h: 120,
Â  Â  Â  Â  title: "å±•å° 02ï¼šå…ƒå®‡å®™æ•™è‚²é«”é©—",Â 
Â  Â  Â  Â  desc: "æˆ´ä¸ŠVRé ­æˆ´è£ç½®ï¼Œé«”é©—æ²‰æµ¸å¼çš„æ­·å²èª²ç¨‹ã€‚æˆ‘å€‘æä¾›è™›æ“¬å¯¦é©—å®¤èˆ‡é ç«¯æ•™å­¸è§£æ±ºæ–¹æ¡ˆã€‚",
Â  Â  Â  Â  img: `images/2${IMAGE_FORMAT}`
Â  Â  },
Â  Â  {
Â  Â  Â  Â  id: 3, x: 620, y: 100 + Y_OFFSET, w: 200, h: 120,
Â  Â  Â  Â  title: "å±•å° 03ï¼šå€å¡Šéˆé‡‘èå‰µæ–°èˆ‡DeFiæ‡‰ç”¨",Â 
Â  Â  Â  Â  desc: "æ·±å…¥äº†è§£å»ä¸­å¿ƒåŒ–é‡‘èï¼ˆDeFiï¼‰çš„é‹ä½œåŸç†ï¼Œä»¥åŠå¦‚ä½•åˆ©ç”¨æ™ºèƒ½åˆç´„ä¿éšœè³‡ç”¢å®‰å…¨ã€‚",
Â  Â  Â  Â  img: `images/3${IMAGE_FORMAT}`
Â  Â  },
Â  Â  {
Â  Â  Â  Â  id: 4, x: 880, y: 100 + Y_OFFSET, w: 200, h: 120,
Â  Â  Â  Â  title: "å±•å° 04ï¼šAIç¹ªåœ–èˆ‡è¨­è¨ˆæŠ€è¡“å±•ç¤º",Â 
Â  Â  Â  Â  desc: "å±•ç¤ºå¤šç¨®ç”Ÿæˆå¼AIè—è¡“ä½œå“ï¼Œä¸¦æä¾›äº’å‹•å·¥å…·è®“æ‚¨è¦ªè‡ªé«”é©—AIå‰µä½œçš„æ¨‚è¶£ã€‚",
Â  Â  Â  Â  img: `images/4${IMAGE_FORMAT}`
Â  Â  },
Â  Â  {
Â  Â  Â  Â  id: 5, x: 1140, y: 100 + Y_OFFSET, w: 200, h: 120,
Â  Â  Â  Â  title: "å±•å° 05ï¼šæ–°èƒ½æºå„²å­˜æŠ€è¡“",Â 
Â  Â  Â  Â  desc: "æ¢ç´¢é«˜æ•ˆèƒ½é‹°é›»æ± èˆ‡å›ºæ…‹é›»æ± æŠ€è¡“ï¼Œä»¥åŠå®¶åº­å’Œå·¥æ¥­ç´šå„²èƒ½ç³»çµ±çš„æœ€æ–°é€²å±•ã€‚",
Â  Â  Â  Â  img: `images/5${IMAGE_FORMAT}`
Â  Â  },
Â  Â  {
Â  Â  Â  Â  id: 6, x: 1400, y: 100 + Y_OFFSET, w: 200, h: 120,
Â  Â  Â  Â  title: "å±•å° 06ï¼šç„¡äººæ©Ÿè¾²æ¥­æ‡‰ç”¨",Â 
Â  Â  Â  Â  desc: "å±•ç¤ºå¦‚ä½•åˆ©ç”¨é«˜è§£æåº¦ç©ºæ‹èˆ‡æ•¸æ“šåˆ†æï¼Œå¯¦ç¾ç²¾æº–çŒæº‰ã€ç—…èŸ²å®³ç›£æ¸¬å’Œä½œç‰©å¥åº·ç®¡ç†ã€‚",
Â  Â  Â  Â  img: `images/6${IMAGE_FORMAT}`
Â  Â  },

Â  Â  // --- ç¬¬äºŒæ’ (åŸ Y=360 -> ç¾ Y=480) ---
Â  Â  {
Â  Â  Â  Â  id: 7, x: 100, y: 360 + Y_OFFSET, w: 200, h: 120,
Â  Â  Â  Â  title: "å±•å° 07ï¼š5G+é è·é†«ç™‚æ–°æ–¹æ¡ˆ",Â 
Â  Â  Â  Â  desc: "ä»‹ç´¹é«˜é€Ÿ5Gç¶²è·¯å¦‚ä½•å¯¦ç¾å³æ™‚æœƒè¨ºã€é ç«¯æ‰‹è¡“è¼”åŠ©å’Œç©¿æˆ´å¼å¥åº·ç›£æ¸¬è£ç½®ã€‚",
Â  Â  Â  Â  img: `images/7${IMAGE_FORMAT}`
Â  Â  },
Â  Â  {
Â  Â  Â  Â  id: 8, x: 360, y: 360 + Y_OFFSET, w: 200, h: 120,
Â  Â  Â  Â  title: "å±•å° 08ï¼šç”Ÿç‰©ç§‘æŠ€èˆ‡åŸºå› ç·¨è¼¯",Â 
Â  Â  Â  Â  desc: "æ·±å…¥æ·ºå‡ºåœ°è§£èªª CRISPR æŠ€è¡“çš„å€«ç†èˆ‡æ‡‰ç”¨ï¼Œä»¥åŠæœªä¾†åœ¨é†«å­¸é ˜åŸŸçš„æ½›åŠ›ã€‚",
Â  Â  Â  Â  img: `images/8${IMAGE_FORMAT}`
Â  Â  },
Â  Â  {
Â  Â  Â  Â  id: 9, x: 620, y: 360 + Y_OFFSET, w: 200, h: 120,
Â  Â  Â  Â  title: "å±•å° 09ï¼šå·¥æ¥­4.0èˆ‡è‡ªå‹•åŒ–æµç¨‹",Â 
Â  Â  Â  Â  desc: "åƒè§€è‡ªå‹•åŒ–ç”Ÿç”¢ç·šæ¨¡å‹ï¼Œäº†è§£æ„Ÿæ¸¬å™¨ã€æ©Ÿå™¨äººèˆ‡æ•¸æ“šåˆ†æåœ¨æ™ºæ…§å·¥å» ä¸­çš„å”åŒé‹ä½œã€‚",
Â  Â  Â  Â  img: `images/9${IMAGE_FORMAT}`
Â  Â  },
Â  Â  {
Â  Â  Â  Â  id: 10, x: 880, y: 360 + Y_OFFSET, w: 200, h: 120,
Â  Â  Â  Â  title: "å±•å° 10ï¼šç¶²è·¯å®‰å…¨é˜²è­·èˆ‡å¨è„…é è­¦",Â 
Â  Â  Â  Â  desc: "è¬›è§£å¦‚ä½•é˜²ç¦¦æœ€æ–°çš„å‹’ç´¢è»Ÿé«”èˆ‡ç¶²è·¯é‡£é­šæ”»æ“Šï¼Œæå‡å€‹äººåŠä¼æ¥­çš„è³‡è¨Šå®‰å…¨æ„è­˜ã€‚",
Â  Â  Â  Â  img: `images/10${IMAGE_FORMAT}`
Â  Â  },
Â  Â  {
Â  Â  Â  Â  id: 11, x: 1140, y: 360 + Y_OFFSET, w: 200, h: 120,
Â  Â  Â  Â  title: "å±•å° 11ï¼šæ°£å€™è®Šé·æ•¸æ“šåˆ†æ",Â 
Â  Â  Â  Â  desc: "å±•ç¤ºåˆ©ç”¨å¤§æ•¸æ“šæ¨¡å‹é æ¸¬æ°£å€™è¶¨å‹¢ï¼Œä¸¦è©•ä¼°æ¥µç«¯å¤©æ°£å°å…¨çƒç’°å¢ƒçš„å½±éŸ¿ã€‚",
Â  Â  Â  Â  img: `images/11${IMAGE_FORMAT}`
Â  Â  },
Â  Â  {
Â  Â  Â  Â  id: 12, x: 1400, y: 360 + Y_OFFSET, w: 200, h: 120,
Â  Â  Â  Â  title: "å±•å° 12ï¼šäº’å‹•éŠæˆ²è¨­è¨ˆèˆ‡å¼•æ“é–‹ç™¼",Â 
Â  Â  Â  Â  desc: "æœ¬å€å±•ç¤ºäº†ç¨ç«‹éŠæˆ²é–‹ç™¼åœ˜éšŠçš„æœ€æ–°ä½œå“ï¼Œæä¾›è©¦ç©å€è®“åƒè§€è€…é«”é©—éŠæˆ²é­…åŠ›ã€‚",
Â  Â  Â  Â  img: `images/12${IMAGE_FORMAT}`
Â  Â  },

Â  Â  // --- ç¬¬ä¸‰æ’ (åŸ Y=620 -> ç¾ Y=740) ---
Â  Â  {
Â  Â  Â  Â  id: 13, x: 100, y: 620 + Y_OFFSET, w: 200, h: 120,
Â  Â  Â  Â  title: "å±•å° 13ï¼šå¤ªç©ºæ¢ç´¢èˆ‡è¡›æ˜ŸæŠ€è¡“",Â 
Â  Â  Â  Â  desc: "ä»‹ç´¹ä½è»Œé“è¡›æ˜Ÿï¼ˆLEOï¼‰çš„é€šè¨ŠæŠ€è¡“ï¼Œä»¥åŠä¸‹ä¸€ä»£ç«ç®­æ¨é€²ç³»çµ±çš„ç ”ç™¼é€²åº¦ã€‚",
Â  Â  Â  Â  img: `images/13${IMAGE_FORMAT}`
Â  Â  },
Â  Â  {
Â  Â  Â  Â  id: 14, x: 360, y: 620 + Y_OFFSET, w: 200, h: 120,
Â  Â  Â  Â  title: "å±•å° 14ï¼šæ°¸çºŒå»ºç¯‰èˆ‡ç¶ è‰²å»ºæ",Â 
Â  Â  Â  Â  desc: "å±•ç¤ºå¦‚ä½•åˆ©ç”¨å¯å›æ”¶ææ–™èˆ‡æ™ºæ…§èƒ½æºç®¡ç†ï¼Œæ‰“é€ ä½ç¢³æ’æ”¾çš„ç’°ä¿å»ºç¯‰ã€‚",
Â  Â  Â  Â  img: `images/14${IMAGE_FORMAT}`
Â  Â  },
Â  Â  {
Â  Â  Â  Â  id: 15, x: 620, y: 620 + Y_OFFSET, w: 200, h: 120,
Â  Â  Â  Â  title: "å±•å° 15ï¼šæ“´å¢å¯¦å¢ƒ(AR)è³¼ç‰©é«”é©—",Â 
Â  Â  Â  Â  desc: "é«”é©—ARè™›æ“¬è©¦ç©¿èˆ‡ç”¢å“é è¦½ï¼Œé©æ–°ç·šä¸‹èˆ‡ç·šä¸Šçš„é›¶å”®é«”é©—ã€‚",
Â  Â  Â  Â  img: `images/15${IMAGE_FORMAT}`
Â  Â  },
Â  Â  {
Â  Â  Â  Â  id: 16, x: 880, y: 620 + Y_OFFSET, w: 200, h: 120,
Â  Â  Â  Â  title: "å±•å° 16ï¼šé‡å­è¨ˆç®—åŸºç¤ä»‹ç´¹",Â 
Â  Â  Â  Â  desc: "è¬›è§£é‡å­ä½å…ƒã€ç–ŠåŠ æ…‹èˆ‡é‡å­ç³¾çºç­‰åŸºæœ¬æ¦‚å¿µï¼Œæ¢ç´¢é‡å­é›»è…¦çš„ç„¡é™å¯èƒ½ã€‚",
Â  Â  Â  Â  img: `images/16${IMAGE_FORMAT}`
Â  Â  },
Â  Â  {
Â  Â  Â  Â  id: 17, x: 1140, y: 620 + Y_OFFSET, w: 200, h: 120,
Â  Â  Â  Â  title: "å±•å° 17ï¼šäººæ©Ÿå”ä½œæ©Ÿå™¨äººæ‡‰ç”¨",Â 
Â  Â  Â  Â  desc: "å±•ç¤ºè¼•é‡ç´šå”ä½œæ©Ÿå™¨äººï¼ˆCobotsï¼‰å¦‚ä½•åœ¨å·¥å» ä¸­å®‰å…¨åœ°èˆ‡äººé¡å“¡å·¥ä¸¦è‚©å·¥ä½œã€‚",
Â  Â  Â  Â  img: `images/17${IMAGE_FORMAT}`
Â  Â  },
Â  Â  {
Â  Â  Â  Â  id: 18, x: 1400, y: 620 + Y_OFFSET, w: 200, h: 120,
Â  Â  Â  Â  title: "å±•å° 18ï¼šæ²‰æµ¸å¼éŸ³è¨ŠæŠ€è¡“",Â 
Â  Â  Â  Â  desc: "é«”é©— 3D ç©ºé–“éŸ³è¨ŠæŠ€è¡“å¦‚ä½•ç‚ºé›»å½±ã€éŠæˆ²å’ŒéŸ³æ¨‚å¸¶ä¾†æ›´çœŸå¯¦çš„è½è¦ºæ„Ÿå—ã€‚",
Â  Â  Â  Â  img: `images/18${IMAGE_FORMAT}`
Â  Â  },

Â  Â  // --- ç¬¬å››æ’ (åŸ Y=880 -> ç¾ Y=1000) ---
Â  Â  {
Â  Â  Â  Â  id: 19, x: 100, y: 880 + Y_OFFSET, w: 200, h: 120,
Â  Â  Â  Â  title: "å±•å° 19ï¼šæ•¸æ“šå¯è¦–åŒ–æ‡‰ç”¨æ¡ˆä¾‹",Â 
Â  Â  Â  Â  desc: "é€éå‹•æ…‹åœ–è¡¨å’Œè¦–è¦ºåŒ–ä»‹é¢ï¼Œå°‡è¤‡é›œçš„æ•¸æ“šé›†è½‰åŒ–ç‚ºæ˜“æ–¼ç†è§£çš„æ•…äº‹ã€‚",
Â  Â  Â  Â  img: `images/19${IMAGE_FORMAT}`
Â  Â  },
Â  Â  {
Â  Â  Â  Â  id: 20, x: 360, y: 880 + Y_OFFSET, w: 200, h: 120,
Â  Â  Â  Â  title: "å±•å° 20ï¼šé–‹æ”¾åŸå§‹ç¢¼å°ˆæ¡ˆ",Â 
Â  Â  Â  Â  desc: "é›†åˆäº†å¤šå€‹å„ªç§€çš„ç¤¾ç¾¤é©…å‹•å‹é–‹æºè»Ÿé«”å’Œç¡¬é«”å°ˆæ¡ˆï¼Œé¼“å‹µè‡ªç”±äº¤æµèˆ‡è²¢ç»ã€‚",
Â  Â  Â  Â  img: `images/20${IMAGE_FORMAT}`
Â  Â  },
Â  Â  {
Â  Â  Â  Â  id: 21, x: 620, y: 880 + Y_OFFSET, w: 200, h: 120,
Â  Â  Â  Â  title: "å±•å° 21ï¼šæ™ºæ…§è¾²æ¥­èˆ‡æ°´è³‡æºç®¡ç†",Â 
Â  Â  Â  Â  desc: "åˆ©ç”¨ IoT æ„Ÿæ¸¬å™¨ç›£æ¸¬åœŸå£¤æ¿•åº¦å’Œæ°£è±¡æ•¸æ“šï¼Œå„ªåŒ–çŒæº‰ï¼Œç¯€ç´„æ°´è³‡æºã€‚",
Â  Â  Â  Â  img: `images/21${IMAGE_FORMAT}`
Â  Â  },
Â  Â  {
Â  Â  Â  Â  id: 22, x: 880, y: 880 + Y_OFFSET, w: 200, h: 120,
Â  Â  Â  Â  title: "å±•å° 22ï¼šè»Ÿé«”å·¥ç¨‹æœ€ä½³å¯¦è¸æŒ‡å—",Â 
Â  Â  Â  Â  desc: "ä»‹ç´¹ DevOpsã€æ•æ·é–‹ç™¼ï¼ˆAgileï¼‰èˆ‡æ¸¬è©¦é©…å‹•é–‹ç™¼ï¼ˆTDDï¼‰ç­‰ç¾ä»£é–‹ç™¼æµç¨‹ã€‚",
Â  Â  Â  Â  img: `images/22${IMAGE_FORMAT}`
Â  Â  },
Â  Â  {
Â  Â  Â  Â  id: 23, x: 1140, y: 880 + Y_OFFSET, w: 200, h: 120,
Â  Â  Â  Â  title: "å±•å° 23ï¼šæœªä¾†äº¤é€šå·¥å…·èˆ‡eVTOL",Â 
Â  Â  Â  Â  desc: "å±•ç¤ºé›»å‹•å‚ç›´èµ·é™é£›è¡Œå™¨ï¼ˆeVTOLï¼‰å’Œè‡ªå‹•é§•é§›æŠ€è¡“çš„æœ€æ–°åŸå‹èˆ‡æ¸¬è©¦æˆæœã€‚",
Â  Â  Â  Â  img: `images/23${IMAGE_FORMAT}`
Â  Â  }
];
// [ä¿®æ”¹çµæŸ]

const canvas=document.getElementById('game');
const ctx=canvas.getContext('2d');
const stage=document.getElementById('stage');
const hud=document.getElementById('hud');
const charModal=document.getElementById('charModal');
const boothModal=document.getElementById('boothModal');
const boothImg = document.getElementById('boothImg');Â 

// ä¸–ç•Œé«˜åº¦å¢åŠ ä»¥å®¹ç´å±•å°ä¸‹ç§»
let worldW=1800,worldH=1600 + Y_OFFSET;Â 
const view={x:0,y:0,scale:1};
function resize(){canvas.width=stage.clientWidth*devicePixelRatio;canvas.height=stage.clientHeight*devicePixelRatio;}
window.addEventListener('resize',resize);resize();

// åœ–ç‰‡è³‡æºç®¡ç†
const images = {};
let imagesLoaded = 0;
let totalImages = NUM_BOOTHS + 1; 

function loadImage(id, path) {
Â  Â  return new Promise(resolve => {
Â  Â  Â  Â  // æ’é™¤ Emoji è§’è‰²ï¼Œåªè¼‰å…¥å±•å°åœ–ç‰‡å’Œä½”ä½åœ–
Â  Â  Â  Â  if (CHAR_PRESETS.some(c => c.id === id)) {
Â  Â  Â  Â  Â  Â  images[id] = { isEmoji: true, emoji: CHAR_PRESETS.find(c => c.id === id).emoji, w: CHAR_PRESETS.find(c => c.id === id).w, h: CHAR_PRESETS.find(c => c.id === id).h };
Â  Â  Â  Â  Â  Â  imagesLoaded++;
Â  Â  Â  Â  Â  Â  resolve(images[id]);
Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  }

Â  Â  Â  Â  const img = new Image();
        if (!path.startsWith('data:')) {
            img.crossOrigin = 'anonymous'; 
        }

Â  Â  Â  Â  img.onload = () => {
Â  Â  Â  Â  Â  Â  images[id] = img;
Â  Â  Â  Â  Â  Â  imagesLoaded++;
Â  Â  Â  Â  Â  Â  hud.textContent = `è¼‰å…¥ä¸­â€¦ åœ–ç‰‡ ${imagesLoaded} / ${totalImages}`;
Â  Â  Â  Â  Â  Â  resolve(img);
Â  Â  Â  Â  };
Â  Â  Â  Â  img.onerror = () => {
Â  Â  Â  Â  Â  Â  // è¼‰å…¥å¤±æ•—æ™‚ä½¿ç”¨ä½”ä½ç¬¦
Â  Â  Â  Â  Â  Â  console.warn(`ç„¡æ³•è¼‰å…¥åœ–ç‰‡: ${path}ï¼Œè«‹ç¢ºèªåœ–ç‰‡æ˜¯å¦å­˜åœ¨ã€‚`);
Â  Â  Â  Â  Â  Â  const fallback = new Image();
Â  Â  Â  Â  Â  Â  fallback.src = `data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='${id.startsWith('booth') ? 200 : 48}' height='${id.startsWith('booth') ? 120 : 64}'><rect width='100%' height='100%' fill='%23666'/><text x='50%' y='50%' dominant-baseline='middle' text-anchor='middle' font-size='14' fill='%23ccc'>No Image</text></svg>`;
Â  Â  Â  Â  Â  Â  fallback.onload = () => {
Â  Â  Â  Â  Â  Â  Â  Â  images[id] = fallback;
Â  Â  Â  Â  Â  Â  Â  Â  imagesLoaded++;
Â  Â  Â  Â  Â  Â  Â  Â  hud.textContent = `è¼‰å…¥ä¸­â€¦ åœ–ç‰‡ ${imagesLoaded} / ${totalImages}`;
Â  Â  Â  Â  Â  Â  Â  Â  resolve(fallback);
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  fallback.onerror = () => {
Â  Â  Â  Â  Â  Â  Â  Â  images[id] = false; 
Â  Â  Â  Â  Â  Â  Â  Â  imagesLoaded++;
Â  Â  Â  Â  Â  Â  Â  Â  hud.textContent = `è¼‰å…¥ä¸­â€¦ åœ–ç‰‡ ${imagesLoaded} / ${totalImages}`;
Â  Â  Â  Â  Â  Â  Â  Â  resolve(false);
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  };
Â  Â  Â  Â  img.src = path;
Â  Â  });
}

// player
const initialChar = CHAR_PRESETS[0];
const player={x:300,y:300 + Y_OFFSET,w:initialChar.w,h:initialChar.h,spd:220,spriteId:initialChar.id,name:initialChar.name}; // åˆå§‹ä½ç½®ä¹Ÿå‘ä¸‹ç§»
let gameActive = false;
let selectedCharId = initialChar.id;
let lastTime = 0;

// ---------- è§’è‰²èˆ‡æ¨¡æ…‹è¦–çª—é‚è¼¯ ----------
const panelCharPreview = document.getElementById('panelCharPreview');
const charGrid = document.getElementById('charGrid');
const charConfirm = document.getElementById('charConfirm');
const openCharBtn = document.getElementById('openCharBtn');
const boothClose = document.getElementById('boothClose');

// æ¸²æŸ“è§’è‰²é¸æ“‡ç¶²æ ¼
CHAR_PRESETS.forEach(char => {
Â  Â  const item = document.createElement('div');
Â  Â  item.className = 'char-item';
Â  Â  item.dataset.id = char.id;
Â  Â  item.dataset.name = char.name;
    // é¡¯ç¤º Emoji è§’è‰²
Â  Â  item.innerHTML = `<div>${char.emoji}</div>`; 
Â  Â  if (char.id === selectedCharId) {
Â  Â  Â  Â  item.classList.add('selected');
Â  Â  Â  Â  charConfirm.disabled = false;
Â  Â  }
Â  Â  item.addEventListener('click', () => {
Â  Â  Â  Â  document.querySelectorAll('.char-item').forEach(i => i.classList.remove('selected'));
Â  Â  Â  Â  item.classList.add('selected');
Â  Â  Â  Â  selectedCharId = char.id;
Â  Â  Â  Â  charConfirm.disabled = false;
Â  Â  });
Â  Â  charGrid.appendChild(item);
});

function openModal(modal) {
Â  Â  modal.classList.add('open');
Â  Â  gameActive = false; // æš«åœéŠæˆ²å¾ªç’°
}
function closeModal(modal) {
Â  Â  modal.classList.remove('open');
Â  Â  if(player.spriteId) gameActive = true; // è§’è‰²ç¢ºå®šå¾Œæ‰å•Ÿç”¨éŠæˆ²
}

function updateCharPreview(charId) {
Â  Â  const char = CHAR_PRESETS.find(c => c.id === charId);
Â  Â  if (!char) return;
    // é è¦½é¡¯ç¤º Emoji
Â  Â  panelCharPreview.innerHTML = `
Â  Â  Â  Â  <div style="width:48px;height:48px;border-radius:4px;border:2px solid var(--primary);font-size:36px;display:flex;align-items:center;justify-content:center;margin:0 auto">${char.emoji}</div>
Â  Â  Â  Â  <div style="font-size:14px;margin-top:4px">${char.name}</div>
Â  Â  `;
}

openCharBtn.addEventListener('click', () => openModal(charModal));
boothClose.addEventListener('click', () => closeModal(boothModal));

charConfirm.addEventListener('click', () => {
Â  Â  const selectedChar = CHAR_PRESETS.find(c => c.id === selectedCharId);
Â  Â  player.spriteId = selectedChar.id;
Â  Â  player.name = selectedChar.name;
    // æ›´æ–°ç©å®¶å¤§å°
    player.w = selectedChar.w;
    player.h = selectedChar.h;
Â  Â  updateCharPreview(selectedCharId);
Â  Â  closeModal(charModal);
Â  Â  hud.textContent = `æ­¡è¿ï¼Œ${player.name}ï¼é è¿‘å±•å°æŒ‰ [E] äº’å‹•`;
});

// å•Ÿå‹•æ™‚å…ˆæ‰“é–‹è§’è‰²é¸æ“‡æ¨¡æ…‹è¦–çª—
openModal(charModal);

// åœ–ç‰‡é»æ“Šæ”¾å¤§åŠŸèƒ½
boothImg.addEventListener('click', () => {
Â  Â  const originalSrc = boothImg.dataset.originalSrc;
Â  Â  if (originalSrc) {
Â  Â  Â  Â  window.open(originalSrc, '_blank');
Â  Â  }
});


// [æ–°å¢é–‹å§‹] Canvas æ–‡å­—æ›è¡Œå‡½æ•¸
function wrapText(context, text, maxWidth) {
Â  Â  const words = text.split('');
Â  Â  let line = '';
Â  Â  const lines = [];

Â  Â  for (let i = 0; i < words.length; i++) {
Â  Â  Â  Â  const testLine = line + words[i];
Â  Â  Â  Â  const metrics = context.measureText(testLine);
Â  Â  Â  Â  const testWidth = metrics.width;

Â  Â  Â  Â  if (testWidth > maxWidth && i > 0) {
Â  Â  Â  Â  Â  Â  lines.push(line);
Â  Â  Â  Â  Â  Â  line = words[i];Â 
Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  line = testLine;
Â  Â  Â  Â  }
Â  Â  }
Â  Â  lines.push(line);
Â  Â  return lines;
}
// [æ–°å¢çµæŸ]


// ---------- æ ¸å¿ƒéŠæˆ²å¾ªç’°é‚è¼¯ ----------
function update(dt) {
Â  Â  if (!gameActive) return;

Â  Â  // ç§»å‹•é‚è¼¯ (ç•¥)
Â  Â  let dx = 0, dy = 0;
Â  Â  if (keys.w || keys.arrowup) dy -= 1;
Â  Â  if (keys.s || keys.arrowdown) dy += 1;
Â  Â  if (keys.a || keys.arrowleft) dx -= 1;
Â  Â  if (keys.d || keys.arrowright) dx += 1;
Â  Â  if (Math.hypot(joyVec.x, joyVec.y) > 0.1) {
Â  Â  Â  Â  dx = joyVec.x;
Â  Â  Â  Â  dy = joyVec.y;
Â  Â  }

Â  Â  const len = Math.hypot(dx, dy);
Â  Â  if (len > 0.1) {
Â  Â  Â  Â  const factor = player.spd * dt / len;
Â  Â  Â  Â  let newX = player.x + dx * factor;
Â  Â  Â  Â  let newY = player.y + dy * factor;

Â  Â  Â  Â  newX = Math.max(player.w/2, Math.min(worldW - player.w/2, newX));
Â  Â  Â  Â  newY = Math.max(player.h/2, Math.min(worldH - player.h/2, newY));

Â  Â  Â  Â  player.x = newX;
Â  Â  Â  Â  player.y = newY;
Â  Â  }

Â  Â  // è¦–è§’è·Ÿéš¨ (ç•¥)
Â  Â  const viewW = canvas.width / devicePixelRatio;
Â  Â  const viewH = canvas.height / devicePixelRatio;
Â  Â  view.x = player.x - viewW / 2 / view.scale;
Â  Â  view.y = player.y - viewH / 2 / view.scale;

Â  Â  view.x = Math.max(0, Math.min(worldW - viewW/view.scale, view.x));
Â  Â  view.y = Math.max(0, Math.min(worldH - viewH/view.scale, view.y));
}

function draw() {
Â  Â  ctx.save();
Â  Â  ctx.scale(devicePixelRatio, devicePixelRatio);
Â  Â  ctx.clearRect(0, 0, stage.clientWidth, stage.clientHeight);

Â  Â  ctx.translate(-view.x * view.scale, -view.y * view.scale);
Â  Â  ctx.scale(view.scale, view.scale);
Â  Â Â 
Â  Â  // ç¹ªè£½åœ°åœ–/èƒŒæ™¯
Â  Â  ctx.fillStyle = '#0a223a';
Â  Â  ctx.fillRect(0, 0, worldW, worldH);
Â  Â  ctx.strokeStyle = 'rgba(255,255,255,0.1)';
Â  Â  ctx.lineWidth = 4;
Â  Â  ctx.strokeRect(0, 0, worldW, worldH);

Â  Â  let nearestBooth = null;
Â  Â  let minDistance = Infinity;

Â  Â  // ç¹ªè£½å±•å°
Â  Â  for (const b of booths) {
Â  Â  Â  Â  const img = images[`booth${b.id}`] || images['boothPlaceholder'];
Â  Â  Â  Â  const centerX = b.x + b.w / 2;
Â  Â  Â  Â  const centerY = b.y + b.h / 2;
Â  Â  Â  Â  const playerCenterX = player.x;
Â  Â  Â  Â  const playerCenterY = player.y;

Â  Â  Â  Â  const distance = Math.hypot(centerX - playerCenterX, centerY - playerCenterY);
Â  Â  Â  Â  if (distance < minDistance) {
Â  Â  Â  Â  Â  Â  minDistance = distance;
Â  Â  Â  Â  Â  Â  nearestBooth = b;
Â  Â  Â  Â  }

Â  Â  Â  Â  ctx.drawImage(img, b.x, b.y, b.w, b.h);

Â  Â  Â  Â  // ç¹ªè£½å±•å°åç¨±ï¼Œä½¿ç”¨æ›è¡Œé‚è¼¯
Â  Â  Â  Â  ctx.fillStyle = 'rgba(255,255,255,0.9)';
Â  Â  Â  Â  ctx.font = 'bold 20px "Noto Sans TC"';
Â  Â  Â  Â  ctx.textAlign = 'center';

Â  Â  Â  Â  const MAX_TITLE_WIDTH = b.w + 40; 
Â  Â  Â  Â  const LINE_HEIGHT = 22; 

Â  Â  Â  Â  const lines = wrapText(ctx, b.title, MAX_TITLE_WIDTH);
Â  Â  Â  Â Â 
Â  Â  Â  Â  // ã€ä¿®æ­£é» 1ã€‘ï¼šå°‡æ¨™é¡Œç¹ªè£½çš„ Y åº§æ¨™æ›´å‘ä¸Šèª¿æ•´ (å¾ -10 èª¿æ•´åˆ° -40)
Â  Â  Â  Â  let lineY = b.y - 40 - (lines.length - 1) * LINE_HEIGHT / 2;Â 

Â  Â  Â  Â  lines.forEach((line, index) => {
Â  Â  Â  Â  Â  Â  ctx.fillText(line, b.x + b.w / 2, lineY + index * LINE_HEIGHT);
Â  Â  Â  Â  });
Â  Â  }
Â  Â Â 
Â  Â  // ç¹ªè£½æœ€è¿‘çš„äº’å‹•æç¤º
Â  Â  if(nearestBooth && minDistance < 120 && gameActive){
Â  Â  Â  Â  ctx.fillStyle = varColor('--primary');
Â  Â  Â  Â  ctx.font = 'bold 24px "Noto Sans TC"';
Â  Â  Â  Â  ctx.textAlign = 'center';
Â  Â  Â  Â  ctx.fillText('[E] / äº’å‹•æŒ‰éˆ•', nearestBooth.x + nearestBooth.w / 2, nearestBooth.y + nearestBooth.h + 30);
Â  Â  }

Â  Â  // ç¹ªè£½ç©å®¶è§’è‰²
Â  Â  const playerChar = images[player.spriteId];
Â  Â  if (playerChar) {
        if (playerChar.isEmoji) {
            // ç¹ªè£½ Emoji è§’è‰²
            ctx.font = '40px sans-serif'; 
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';
            ctx.fillText(playerChar.emoji, player.x, player.y); 

        } else {
            // ç¹ªè£½åœ–ç‰‡è§’è‰² (èˆŠé‚è¼¯)
Â  Â  Â  Â  Â  Â  ctx.drawImage(playerChar, player.x - player.w / 2, player.y - player.h / 2, player.w, player.h);
        }

Â  Â  Â  Â  ctx.fillStyle = '#fff';
Â  Â  Â  Â  ctx.font = '16px "Noto Sans TC"';
Â  Â  Â  Â  ctx.fillText(player.name, player.x, player.y - player.h/2 - 10);
Â  Â  } else {
Â  Â  Â  Â  ctx.fillStyle = 'red';
Â  Â  Â  Â  ctx.fillRect(player.x - player.w / 2, player.y - player.h / 2, player.w, player.h);
Â  Â  }

Â  Â  ctx.restore();
}

function loop(currentTime) {
Â  Â  if (!lastTime) lastTime = currentTime;
Â  Â  const dt = (currentTime - lastTime) / 1000;
Â  Â  lastTime = currentTime;

Â  Â  if (imagesLoaded === totalImages) {
Â  Â  Â  Â  update(dt);
Â  Â  Â  Â  draw();
Â  Â  }
Â  Â Â 
Â  Â  requestAnimationFrame(loop);
}

// æ¨¡æ…‹è¦–çª—ï¼šé–‹å•Ÿå±•å° (ç•¥)
function openBooth(booth) {
Â  Â  if (boothModal.classList.contains('open')) return;
Â  Â Â 
Â  Â  document.getElementById('boothTitle').textContent = booth.title;
Â  Â  document.getElementById('boothDesc').textContent = booth.desc;
Â  Â Â 
Â  Â  const img = images[`booth${booth.id}`];
    // æª¢æŸ¥ img æ˜¯å¦ç‚ºæœ‰æ•ˆçš„åœ–ç‰‡ç‰©ä»¶
    const imgPath = img && !img.isEmoji ? img.src : 'data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="400" height="250"><rect width="100%" height="100%" fill="#1a3d5f"/><text x="50%" y="50%" dominant-baseline="middle" text-anchor="middle" font-size="20" fill="#e6eef8">å±•å°åœ–ç‰‡è¼‰å…¥å¤±æ•—æˆ–ä¸å­˜åœ¨</text></svg>';
    
Â  Â  boothImg.src = imgPath;
Â  Â  boothImg.dataset.originalSrc = imgPath;Â 
Â  Â Â 
Â  Â  openModal(boothModal);
}

// ä¿®å¾© tryInteract é‚è¼¯ - åµæ¸¬é è¿‘ (ç•¥)
function tryInteract(){
Â  Â  if (boothModal.classList.contains('open')) return;

Â  Â  for(const b of booths){
Â  Â  Â  Â  const dx = (player.x) - (b.x + b.w / 2);
Â  Â  Â  Â  const dy = (player.y) - (b.y + b.h / 2);
Â  Â  Â  Â  if(Math.hypot(dx, dy) < 120){
Â  Â  Â  Â  Â  Â  openBooth(b);
Â  Â  Â  Â  Â  Â  break;
Â  Â  Â  Â  }
Â  Â  }
}

// å–å¾— CSS è®Šæ•¸é¡è‰² (ç”¨æ–¼ Canvas ç¹ªåœ–) (ç•¥)
function varColor(name) {
Â  Â  return getComputedStyle(document.documentElement).getPropertyValue(name).trim();
}

// 1. è¼‰å…¥åœ–ç‰‡è³‡æº
Promise.all([
Â  Â  ...CHAR_PRESETS.map(c => loadImage(c.id, c.path)), 
Â  Â  ...booths.map(b => loadImage(`booth${b.id}`, b.img)),
Â  Â  loadImage('boothPlaceholder', `data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='200' height='120'><rect width='100%' height='100%' fill='%232c3e50'/><text x='50%' y='50%' dominant-baseline='middle' text-anchor='middle' font-size='18' fill='%23ecf0f1'>å±•å°</text></svg>`)
]).then(() => {
Â  Â  // 2. åœ–ç‰‡å…¨éƒ¨è¼‰å…¥å®Œæˆå¾Œï¼Œåˆå§‹åŒ–ä¸¦å•Ÿå‹•éŠæˆ²å¾ªç’°
Â  Â  // é‡æ–°è¨ˆç®— totalImages (å› ç‚ºè§’è‰²ä¸ç®—åœ–ç‰‡äº†)
Â  Â  totalImages = Object.keys(images).filter(k => !images[k].isEmoji).length;
    imagesLoaded = totalImages; 
    
Â  Â  hud.textContent = 'è¼‰å…¥å®Œæˆï¼Œè«‹é¸æ“‡è§’è‰²é–‹å§‹é«”é©—';
Â  Â  updateCharPreview(selectedCharId);
Â  Â  requestAnimationFrame(loop);
});


// ----------------- åŸæœ‰æ§åˆ¶é‚è¼¯ (ä¿æŒä¸è®Š) -----------------
const keys={};
window.addEventListener('keydown',e=>{
Â  Â  keys[e.key.toLowerCase()]=true;
Â  Â  if((e.key==='e'||e.key==='E') && gameActive && !boothModal.classList.contains('open')) {
Â  Â  Â  Â  tryInteract();
Â  Â  }
});
window.addEventListener('keyup',e=>{keys[e.key.toLowerCase()]=false;});

// pointer drag to pan (ç•¥)
let dragging=false,lastMouse=null;
stage.addEventListener('pointerdown',e=>{if(e.pointerType==='mouse' && gameActive){dragging=true;canvas.style.cursor='grabbing';lastMouse={x:e.clientX,y:e.clientY};}});
window.addEventListener('pointerup',()=>{dragging=false;canvas.style.cursor='grab';lastMouse=null;});
window.addEventListener('pointermove',e=>{if(dragging&&lastMouse){const dx=(e.clientX-lastMouse.x)/view.scale;const dy=(e.clientY-lastMouse.y)/view.scale;view.x-=dx;view.y-=dy;lastMouse={x:e.clientX,y:e.clientY};}});
canvas.style.cursor='grab';Â 

// wheel zoom (ç•¥)
stage.addEventListener('wheel',e=>{
Â  Â  if(!gameActive) return;
Â  Â  e.preventDefault();
Â  Â  const d=Math.sign(e.deltaY)*-0.08;
Â  Â  view.scale=Math.max(0.6,Math.min(1.6,view.scale+d));
},{passive:false});

// click to interact (ç•¥)
canvas.addEventListener('click',e=>{
Â  Â  if(!gameActive || boothModal.classList.contains('open')) return;
Â  Â  const rect=canvas.getBoundingClientRect();
Â  Â  const cx=(e.clientX-rect.left)/rect.width*canvas.width;
Â  Â  const cy=(e.clientY-rect.top)/rect.height*canvas.height;
Â  Â  const wx=(cx/devicePixelRatio)/view.scale+view.x;
Â  Â  const wy=(cy/devicePixelRatio)/view.scale+view.y;
Â  Â  for(const b of booths){
Â  Â  Â  Â  if(wx>=b.x && wx<=b.x+b.w && wy>=b.y && wy<=b.y+b.h){
Â  Â  Â  Â  Â  Â  openBooth(b);
Â  Â  Â  Â  Â  Â  break;
Â  Â  Â  Â  }
Â  Â  }
});

// Mobile joystick & Interact Button (ç•¥)
const joyWrap = document.getElementById('joyWrap');
const stick = document.getElementById('stick');
const touchInteract = document.getElementById('touchInteract');
let joyActive = false;
let joyId = null;
let joyOrigin = null;
let joyVec = { x: 0, y: 0 };
const maxOffset = 48;

function startJoy(e) {
Â  if (!gameActive || boothModal.classList.contains('open')) return;
Â  joyActive = true;
Â  joyId = e.pointerId;
Â  const rect = joyWrap.getBoundingClientRect();
Â  joyOrigin = { x: e.clientX, y: e.clientY };
Â  const relativeX = e.clientX - rect.left;
Â  const relativeY = e.clientY - rect.top;
Â  stick.style.left = `${relativeX}px`;
Â  stick.style.top = `${relativeY}px`;
Â  stick.style.transform = 'translate(-50%, -50%)';
Â  e.preventDefault();Â 
}

function moveJoy(e) {
Â  if (!joyActive || e.pointerId !== joyId) return;
Â  const dx = e.clientX - joyOrigin.x;
Â  const dy = e.clientY - joyOrigin.y;
Â Â 
Â  const len = Math.hypot(dx, dy);
Â  const factor = Math.min(len, maxOffset) / len;

Â  const nx = dx * factor;
Â  const ny = dy * factor;
Â Â 
Â  joyVec.x = nx / maxOffset;
Â  joyVec.y = ny / maxOffset;

Â  stick.style.transform = `translate(${nx - 35}px, ${ny - 35}px)`;Â 
}

function endJoy(e) {
Â  if (e.pointerId !== joyId) return;
Â  joyActive = false;
Â  joyId = null;
Â  joyOrigin = null;
Â  joyVec = { x: 0, y: 0 };
Â Â 
Â  stick.style.left = '50%';
Â  stick.style.top = '50%';
Â  stick.style.transform = 'translate(-50%, -50%)';
}

joyWrap.addEventListener('pointerdown', startJoy);
window.addEventListener('pointermove', moveJoy);Â 
window.addEventListener('pointerup', endJoy);
window.addEventListener('pointercancel', endJoy);

touchInteract.addEventListener('click', () => {
Â  if (!gameActive || boothModal.classList.contains('open')) return;
Â  tryInteract();
});

document.getElementById('boothCount').textContent = NUM_BOOTHS;

</script>
</body>
</html>